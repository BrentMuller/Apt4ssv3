**** SOURCE FILE : M0000694.V03   ***
*
C
C     FORTRAN SUBROUTINE APT013
C  PURPOSE     TO GENERATE THE CANONICAL FORM OF A CIRCLE OR A CYLNDER
C              DEFINED AS TANGENT TO EACH OF THREE GIVEN LINES
C              BY THE FOLLOWING APT STATEMENT.
C              RESULT=CYLNDR/**,L1,**,L2,**,L3
C                **=XLARGE,YLARGE,ZLARGE,XSMALL,YSMALL,ZSMALL
C                CYLNDR CAN BE REPLACED BY CIRCLE
C  LINKAGE     CALL APT013 (RESULT,M1,L1,M2,L2,M3,L3)
C  ARGUMENTS   RESULT  ARRAY TO CONTAIN THE CANONICAL FORM OF
C                      THE RESULTING CYLNDR OR CIRCLE.
C              M1-M3   INTEGER EQUIVALENT OF THE MODIFIER
C                      1=XLARGE  2=YLARGE  3=ZLARGE
C                      4=XSMALL  5=YSMALL  6=ZSMALL
C              L1-L3   ARRAY CONTAINING THE CANONICAL FORM OF THE
C                      PLANE OR LINE.
C  SUBSIDIARIES    TYPE      ENTRY
C                SUBROUTINE  APT077
C                SUBROUTINE  DOTF
C                SUBROUTINE  CROSSV
C                SUBROUTINE  APT075
C                SUBROUTINE  APT047
C                SUBROUTINE  DEFEXT
      SUBROUTINE APT013(RESULT,M1,L1,M2,L2,M3,L3)
      IMPLICIT DOUBLE PRECISION (A-H), DOUBLE PRECISION (O-Z)
C
C
C
      INCLUDE 'TOTAL.INC'
C...  ALL REFERENCES TO VARIABLE A HAVE BEEN CHANGED TO AZ,
C...  BECAUSE A OCCURS IN DEF.INC.
      INCLUDE 'DEF.INC'
      INCLUDE 'DSHAR3.INC'
      INCLUDE 'IDEF.INC'
C
C
      DIMENSION RESULT(7),L1(4),L2(4),L3(4),SL(4,3),TL(4,3),MS(3)
      DIMENSION MT(3),TTL(4,3),PT1(3,2),PT2(3,2),MTT(3)
      DOUBLE PRECISION L1,L2,L3
C...  TRANSFORM FROM BASE TO LOCAL
      CALL APT077(L1,0)
      DO 10 I=1,4
   10 SL(I,1) = L(I)
      MS(1) = M1
C
       CALL APT077(L2,0)
      DO 11 I=1,4
   11 SL(I,2)=L(I)
      MS(2)=M2
C
      CALL APT077(L3,0)
      DO 12 I=1,4
   12 SL(I,3) = L(I)
      MS(3)=M3
C...  GET TWO UNPARALLEL PLANE
      DO 13 J=1,3
      I=J+1
      IF(J.EQ.3) I=1
      CALL DOTF(DOT,SL(1,J),SL(1,I))
      MT(J)=0
      IF(DABS(DOT).LT.0.9999) MT(J)=1
   13 CONTINUE
      IF(MT(1)+MT(2)+MT(3).LE.1) GO TO 98
      IF(MT(1).EQ.0) GO TO 14
      I=1
      J=2
      IF(MT(2).EQ.0) J=3
      GO TO 15
   14 I=2
      J=3
   15 JJ=J+1
      IF(J.EQ.3) JJ=1
      DO 16 K=1,4
      TL(K,1)=SL(K,I)
      TL(K,2)=SL(K,I+1)
      TTL(K,1)=SL(K,J)
   16 TTL(K,2)=SL(K,JJ)
      MT(1)=MS(I)
      MT(2)=MS(I+1)
      MTT(1)=MS(J)
      MTT(2)=MS(JJ)
      TL(4,3) = 0.0
      CALL CROSS(TL(1,1),TL(1,2),TL(1,3))
      CALL VNORM(TL(1,3),TL(1,3))
      DO 17 K=1,4
   17 TTL(K,3)=TL(K,3)
C...  CHECK PERPENDICULARITY
      DO 18 J=1,3
      CALL DOTF (DOT,SL(1,J),TL(1,3))
      IF(DABS(DOT).GT.0.000001) GO TO 98
   18 CONTINUE
C..   GET INTERSECTION POINT
      CALL APT075 (PT1(1,1),TL(1,1))
      CALL APT075(PT1(1,2),TTL(1,1))
C...  OFFSET THE PLANE
      DO 19 I=1,2
      DO 191 J=1,4
  191 L(J)=TL(J,I)
      MN=MT(I)
      ASSIGN 192 TO IRTN
      GO TO 70
  192 DO 193 J=1,4
  193 TL(J,I)=L(J)
      DO 194 J=1,4
  194 L(J)=TTL(J,I)
      MN=MTT(I)
      ASSIGN 195 TO IRTN
      GO TO 70
  195 DO 196 J=1,4
  196 TTL(J,I)=L(J)
   19 CONTINUE
C...  GET INTERSECTION POINT
      CALL APT075 (PT2(1,1),TL(1,1))
      CALL APT075(PT2(1,2),TTL(1,1))
C...  GET PLANE THRU TWO POINTS
      DO 21 J=1,2
      DO 20 I=1,3
   20 TL(I,J)=PT2(I,J)-PT1(I,J)
      CALL CROSS(TL(1,3),TL(1,J),TL(1,J))
      CALL VNORM(TL(1,J),TL(1,J))
   21 CALL DOTF(TL(4,J),TL(1,J),PT1(1,J))
C...  GET INTERSECTION OF TWO PLANES
      CALL APT075 (R(1),TL(1,1))
C--- CII UPDATE TO CHECK FOR INCONSISTENCY  NIU-APR/75
      DO 200 M=1,3
      CALL DOTF(AZ,R,SL(1,M))
      N=MS(M)
      IF(N.GT.3) N=N-3
      IF((SL(4,M)-AZ)*SL(N,M)*(MS(M)-3.5).LT.0.D0) GO TO 98
  200 CONTINUE
      CALL VNORM(TL(1,3),TL(1,3))
      R(4)=TL(1,3)
      R(5)=TL(2,3)
      R(6)=TL(3,3)
      R(7) = SL(4,1)-SL(1,1)*R(1)-SL(2,1)*R(2)-SL(3,1)*R(3)
      R(7) = DABS(R(7))
      GO TO 99
   98 IERROR = 43
   99 CALL DEFEXT(RESULT)
      RETURN
C.... GET PARALLEL PLANE.
   70 JI=MOD(MN-1,3)
      DUMMY1=MN
      S1=L(JI+1)*(3.5D0-DUMMY1)
      IF(S1.NE.0.0D0) GO TO 80
      IERROR=59
      GO TO 99
   80 L(4)=L(4)+DSIGN(0.5D0,S1)
      GOTO IRTN,(192,195)
      E N D
