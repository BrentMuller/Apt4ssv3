**** SOURCE FILE : M0006681.V05   ***
*
C
C              FORTRAN SUBROUTINE RLSBUF
C
C LINKAGE      SUBROUTINE RLSBUF
C
C          SUBSIDIARIES                  CALLED BY
C          TYPE          ENTRY           TYPE          ENTRY
C          SUBROUTINE    AWRITE          SUBROUTINE    CILOUT
C                                        SUBROUTINE    ICMPRS
C                                        SUBROUTINE    IEPLOG
C
      SUBROUTINE RLSBUF
C
      IMPLICIT INTEGER (A-Z)
C
C       33.    SYMBOLIC FILE DEFINITIONS
C
      INCLUDE 'SYMFIL.INC'
C ELFIL1:          INTERMEDIATE LANGUAGE FILE
C ELFIL2:          PART PROGRAMMING TEXT GENERATED BY INTERPRETER
C ELFIL3:          MACRO TEXT GENERATED FOR INTERPRETER
C
C       34.    COMMON BLOCK FOR INTERPRETIVE C.I.L. OUTPUT
C
      INCLUDE 'OUTBUF.INC'
C MACFLG:      TRUE WHEN MACRO PROCESSING IN EFFECT (INTERPRETER)
C LABFLG:      INDICATES I.L. COMMAND IS LABEL (INTERPRETER)
C RSVFLG:      TRUE IF I.L. COMMAND IS A RESRV (INTERPRETER)
C LPAGE:       NUMBER OF PAGES OF ENTRY,HOLDAT,LABEL AND RESRV COMMANDS
C IBUF:        NUMBER OF RECORDS IN BUFFER ARRAY
C ILBUF:       NUMBER OF ITEMS IN THE LABBUF ARRAY (INTERPRETER)
C PPPAGE:      PAGE NUMBER OF PART PROGRAMMING TEXT (INTERPRETER)
C MCPAGE:      NUMBER OF PAGES OF MACRO I.L. (INTERPRETER)
C BUFFER:      TEMPORARY STORAGE FOR INTERPRETER OUTPUT (PAGES)
C LABBUF:      TEMPORARY STORAGE FOR LABEL,HOLDAT ENTRY AND RESRV I.L.
C*
      INTEGER ZERO
      DATA ZERO/0/
C**
C...     TEST WHETHER THIS IS LABEL AND RESRV CODE
C
      IF ((LABFLG).OR.(RSVFLG)) GOTO 100
C
C
      IF(IBUF.EQ.0) RETURN
C
C...     NO. IS IT MACRO CODE
C
      IF (MACFLG) GOTO 300
C
C...     NO. THIS IS PART-PROGRAM CODE AND IS WRITTEN TO FILE 2
C...     FORM MARKER WORD, AND UPDATE PAGE COUNT
C
  200 PPPAGE = PPPAGE+1
      N=0
      BUFFER(1) = PPPAGE
      BUFFER(2) = IBUF
      CALL AWRITE(ELFIL2,N,BUFFER,256,IRET)
C
C...     RESET BUFFER POINTER AND RETURN
C
  210 IBUF = 0
      RETURN
C
C...     MACRO CODE IS WRITTEN TO FILE 3
C...     FORM MARKER WORD, AND UPDATE PAGE COUNT
C
  300 MCPAGE = MCPAGE+1
      N=0
      BUFFER(1) = -MCPAGE
      BUFFER(2) = IBUF
      CALL AWRITE(ELFIL3,N,BUFFER,256,IRET)
      GOTO 210
C
C...     LABEL AND RESRV CODE IS WRITTEN TO FILE 1
C...     ITS PAGES HAVE ZERO PAGE NUMBERS
C
  100 LPAGE = LPAGE+1
      N=0
      LABBUF(1) = ZERO
      LABBUF(2) = ILBUF
      CALL AWRITE(ELFIL1,N,LABBUF,256,IRET)
C
C...     RESET BUFFER POINTER AND RETURN
C
      ILBUF = 0
      RETURN
       END
