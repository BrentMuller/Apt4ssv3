**** SOURCE FILE : M0002827.W01   ***
*
C
C...  FORTRAN SUBROUTINE               CUTTER
      SUBROUTINE CUTTER(NMBR,PRM)
      IMPLICIT DOUBLE PRECISION(A-H),DOUBLE PRECISION(O-Z)
C
C-VAX.... MODIFICATION TO PERMIT RESTART PROCEDURE USING
C-VAX     VAX CONDITION HANDLING FACILITIES
      LOGICAL FLG
      FLG=.FALSE.
C.... ESTABLISH CONDITION HANDLER FRO AERR ERROR
      CALL APT241
   1  CALL CUTTES(NMBR,PRM,FLG)
      IF (FLG) GOTO 1
C.... REVERT TO DEFAULT CONDITION HANDLER
      CALL LIB$REVERT
      RETURN
      END
C
      SUBROUTINE CUTTES(NMBR,PRM,FLG)
C
      IMPLICIT DOUBLE PRECISION(A-H),DOUBLE PRECISION(O-Z)
C
      INCLUDE 'TOTAL.INC'
      INCLUDE 'FXCOR.INC'
      INCLUDE 'ZNUMBR.INC'
      INCLUDE 'IFXCOR.INC'
      INCLUDE 'ISHR18.INC'
      INCLUDE 'KNUMBR.INC'
C
C
C
      INTEGER HCUTER(2)
      INTEGER BCDF
C
C
C     25.   COMMON FOR AERR INFORMATION
C
      COMMON /AERCOM / IAERFG
C
      COMMON /HOLD/ JHLDFG,ITHCNT,ITABH(100)
      COMMON /HSAVE/ SAVEH(50)
      EQUIVALENCE  (SAVEH( 6),PARAM(1) ),(SAVEH(15),NUMBER    )
      DIMENSION PRM(9)
C     -----------------------------------------------------------
C
C
C...  DEFINES CUTTER SHAPE AND SETS UP TOOL DATA BLOCKS
      DIMENSION PARAM(9)
      LOGICAL FLG
      HCUTER(1) = BCDF('CUTT')
      HCUTER(2) = BCDF('ER  ')
      IF(FLG)GO TO 9990
      FLG=.TRUE.
      DO 500 I=1,9
  500 PARAM(I)=PRM(I)
      NUMBER=NMBR
      IF(JHLDFG.EQ.0) GO TO 501
      ITABH(ITHCNT)=5
      ITHCNT=ITHCNT+1
      RETURN
C
  501 CONTINUE
  105 ICTDEF=K1
C...  ZERO CUTTER PARAMETER STORAGE AREA
      DO 110 J=1,7
  110 CUTDAT(J)=Z0
      CUTDAT(7) = TLHIT
      IF(NUMBER-K7)126,126,125
  125 NUMERR=22201
      GO TO 1000
  126 DO 127 J=1,NUMBER
  127 CUTDAT(J)=PARAM(J)
C  WRITE CUTTER STATEMENT ON EXFILE
      CALL APT299(NUMBER,HCUTER,1,PARAM(1))
      IF(NUMBER.LE.1) GO TO 129
      KK=1
      DO 128 I=2,NUMBER,2
      IF(I.EQ.NUMBER) KK=0
  128 CALL APT299(1,PARAM(I),KK,PARAM(I+1))
C
C  PLACE ZEROES IN TLLDAT BLOCK
C
  129 DO 1 I=1,8
      TLHITE(I)=Z0
      SINL(I)=Z0
      COSL(I)=Z0
      UMAX(I)=Z0
      RI(I)=Z0
      CORRAD(I)=Z0
      TCONT(I)=Z0
      TLINC(I)=Z0
    1 CONTINUE
C  MAKE SURE TOOL DIAMETER NOT LESS THAN ZERO
      IF(CUTDAT(1))2,92,3
    2 NUMERR=22202
      GO TO 1000
C  EXAMINE TOOL HEIGHT. IF LESS THAN ZERO ERROR. SET TO 5 IF = ZERO.
C  OKAY OTHERWISE
    3 IF(CUTDAT(7))4,5,6
    4 NUMERR=22203
      GO TO 1000
    5 CONTINUE
C  SUM OF ANGLES A AND B MUST BE LESS THAN 90 DEGREES
    6 IF(Z90-CUTDAT(5)-CUTDAT( 6))7,7,8
    7 NUMERR=22204
      GO TO 1000
    8 RI(6)=Z5EM1*CUTDAT(1)
      CUTDAT(1)=RI(6)
C  ERROR IF ANGLE A NEGATIVE
      IF(CUTDAT(5))9,10,11
    9 NUMERR=22205
      GO TO 1000
   10 COSL(2)=Z1
      TANHI(1)=Z1E38
      GO TO 12
C  COMPUTE PARAMETERS FOR CERTAIN TOOL SEGMENTS FOR A GREATER THAN ZERO
   11 TLHITE(8)=DEGRAD*CUTDAT(5)
      SINL(2)=DSIN(TLHITE(8))
      COSL(2)=DCOS(TLHITE(8))
      TCONT(1)=SINL(2)/COSL(2)
      TLHITE(6)=TCONT(1)*RI(6)
      TANHI(1)=Z1/TCONT(1)
C  MAKE SURE HEIGHT OF BOTTOM LINE SEGMENT DOES NOT EXCEED TOOL HEIGHT
   12 IF(Z1EM5-DABS(CUTDAT(7)-TLHITE(6))) 13,13,15
   13 IF(CUTDAT(7)-TLHITE(6))14,14,16
   14 NUMERR=22206
      GO TO 1000
   15 TLHITE(6)=CUTDAT(7)
C  ERROR IF ANGLE B NEGATIVE
   16 IPT1=K1
      IF(CUTDAT(6))17,18,19
C                    BELL SHAPED CUTTER
   17 CALL AERR (-22207,'CUTTER  ')
      GO TO 19
   18 SINL(6)=Z1
      GO TO 20
C  COMPUTE PARAMETERS FOR CERTAIN TOOL SEGMENTS FOR B GREATER THAN ZERO
   19 TANHI(8)=DEGRAD*CUTDAT(6)
      SINL(6)=DCOS(TANHI(8))
      COSL(6)=DSIN(TANHI(8))
      TANLO(7)=COSL(6)/SINL(6)
C  FURTHER CALCULATIONS
   20 UMAX(2)=RI(6)/COSL(2)
      UMAX(6)=(CUTDAT(7)-TLHITE(6))/SINL(6)
      RI(7)=RI(6)+COSL(6)*UMAX(6)
      TCONT(2)=Z1
      TCONT(6)=Z1
C  EXAMINE TOOL RADIUS. IF GREATER THAN ZERO, CORNER CIRCLE WILL BE PART
C  OF TOOL CONFIGURATION. IF = ZERO, TOOL WILL CONSIST ONLY OF LINE AND
C  POINT CIRCLE SEGMENTS. ERROR IF NEGATIVE.
      IF(CUTDAT(2))21,22,25
   21 NUMERR=22208
      GO TO 1000
C  COMPARE LENGTH OF UPPER LINE SEGMENT TO ZERO. SET VALUES IN TLLDAT
C  BLOCK ACCORDINGLY
   22 IF(UMAX(6))23,23,24
   23 TANLO(7)=TANHI(1)
      TCONT(6)=Z0
      GO TO 87
   24 TLHITE(4)=TLHITE(6)
      RI(4)=RI(6)
      TANHI(4)=TANLO(7)
      TANLO(4)=TANHI(1)
      GO TO 86
C  COMPUTE CENTER OF CORNER CIRCLE
   27 CUTDAT(3)=RI(6)-CORRAD(4)
      CUTDAT(4)=CORRAD(4)
      GO TO 26
C  STORE RADIUS OF CORNER CIRCLE AND COMPUTE DISTANCE FROM CENTER OF
C  CIRCLE TO BOTTOM LINE (UMAX(3))
   25 CORRAD(4)=CUTDAT(2)
   26 UMAX(3)=CUTDAT(4)*COSL(2)-CUTDAT(3)*SINL(2)
      TANLO(1)=CUTDAT(3)*CUTDAT(3)+CUTDAT(4)*CUTDAT(4)
C  IF = 0, CENTER OF CORNER CIRCLE HAS TO BE CALCULATED
      IF(TANLO(1)+CUTDAT(5)+CUTDAT(6)*CUTDAT(6))28,27,28
C  DISTANCE FROM CENTER OF CIRCLE TO INTERSECTION OF LINE SEGMENTS
   28 UMAX(1)=DSQRT((CUTDAT(3)-RI(6))*(CUTDAT(3)-RI(6))
     1        +(CUTDAT(4)-TLHITE(6))*(CUTDAT(4)-TLHITE(6)))
      UMAX(7)=TANLO(7)*(CUTDAT(7)-TLHITE(6))
C  DISTANCE FROM CENTER OF CIRCLE TO UPPER END OF UPPER LINE SEGMENT
      UMAX(4)=DSQRT((CUTDAT(4)-CUTDAT(7))*(CUTDAT(4)-CUTDAT(7))
     1        +(CUTDAT(3)-RI(7))*(CUTDAT(3)-RI(7)))
C  IF THE Y COORD. (F) OF THE CENTER OF THE CORNER CIRCLE IS LESS THAN
C  THE Y COORD. OF THE INTERSECTION OF THE LINES, THEN ERROR
      IF(CUTDAT(4)+Z1EM5-TLHITE(6))29,29,30
   29 NUMERR=22209
      GO TO 1000
C  IF THE RADIUS IS BOTH LARGER THAN THE DISTANCE TO THE INTERSECTION
C  OF THE LINES AND DIFFERENT THAN THE DISTANCE TO THE ORIGIN OF THE
C  BOTTOM LINE SEGMENT, WE HAVE AN INVALID TOOL CONFIGURATION
   33 IF(Z1EM5-DABS(TANLO(1)-CORRAD(4)*CORRAD(4))) 34,34,35
   34 NUMERR=22210
      GO TO 1000
C  IF E GREATER THAN ZERO, WE HAVE AN INVALID TOOL CONFIGURATION
   35 IF(CUTDAT(3))53,37,34
   53 CALL AERR(-22211,'CUTTER  ')
      TANHI(1)=CUTDAT(4)/CUTDAT(3)
      TCONT(1)=CUTDAT(3)/CUTDAT(4)
C  NO LOWER LINE SEGMENT
   54 TCONT(2)=Z0
C  FURTHER TLLDAT VARIABLES
   55 TANLO(4)=TANHI(1)
   56 UMAX(5)=(RI(6)-CUTDAT(3))*SINL(6)+COSL(6)*(CUTDAT(4)-TLHITE(6))
C  IF = 0, THERE IS NO UPPER LINE SEGMENT AND IN THIS CASE TOOL NO GOOD
      IF(UMAX(6))67,57,67
C  IF GREATER THAN ZERO, RADIUS AND DISTANCE FROM CENTER OF CORNER
C  CIRCLE TO INTERSECTION OF LINES EQUAL.
   67 IF(CORRAD(4)-UMAX(1))68,68,62
   68 TCONT(7)=CORRAD(4)*CORRAD(4)-UMAX(5)*UMAX(5)
C  LENGTH OF UPPER LINE SEGMENT
      UMAX(6)=UMAX(6)+DSQRT(DABS(TCONT(7)))
     1       -DSQRT(UMAX(1)*UMAX(1)-UMAX(5)*UMAX(5))
      UMAX(8)=CUTDAT(4)-CUTDAT(7)-TANLO(7)*(UMAX(7)+RI(6)-CUTDAT(3))
      IF(Z1EM5-DABS(UMAX(8))) 72,72,69
   72 IF(UMAX(8))73,73,77
C  IF GREATER THAN ZERO, UPPER LINE SEGMENT WITH CORNER CIRCLE TANGENT.
C  OTHERWISE CORNER CIRCLE, PT. CIRCLE, UPPER LINE, AND THEN PT. CIRCLE
   73 IF(Z1EM5-DABS(TCONT(7))) 75,75,74
   75 IF(TCONT(7))76,76,83
   76 GO TO 41
   57 NUMERR=22212
      GO TO 1000
C  WE MUST CHANGE PARAMETERS FOR BOTTOM POINT CIRCLE DUE TO NATURE OF
C  CORNER CIRCLE
   37 CALL AERR(-22211,'CUTTER  ')
      TCONT(1)=Z0
      TANHI(1)=Z1E38
      GO TO 54
C  IF GREATER THAN OR EQUAL TO ZERO, CORNER CIRCLE IS A POINT CIRCLE
   30 IF(Z1EM5-DABS(CORRAD(4)-UMAX(1))) 32,31,31
   31 CORRAD(4) = 0.
      TANLO(1) = 0.
      UMAX(1) = 0.
      UMAX(3) = 0.
      UMAX(4) = 0.
      UMAX(7) = 0.
      CUTDAT(2) = 0.
      CUTDAT(3) = 0.
      CUTDAT(4) = 0.
      GO TO 22
   32 IF (CORRAD(4)-UMAX(1)) 38,38,33
   38 IF(RI(6)+TCONT(1)*(TLHITE(6)-CUTDAT(4))-
     1CUTDAT(3)+Z1EM5)39,39,40
C  CORNER CIRCLE INTERSECTS LOWER LINE SEGMENT AT AN UNACCEPTABLE ANGLE
   39 NUMERR=22213
      GO TO 1000
   40 IF(CUTDAT(4)+Z1EM5-TLHITE(6)-TANLO(7)*(RI(6)-
     1CUTDAT(3)))41,41,42
C  CORNER CIRCLE INTERSECTS UPPER LINE SEGMENT AT AN UNACCEPTABLE ANGLE
   41 NUMERR=22214
      GO TO 1000
   42 TANLO(3)=CORRAD(4)*CORRAD(4)-UMAX(3)*UMAX(3)
      IF(TANLO(3).LT.Z0)GO TO 39
C  LENGTH OF LOWER LINE SEGMENT
      UMAX(2)=UMAX(2)+DSQRT(TANLO(3))
     1       -DSQRT(UMAX(1)*UMAX(1)-UMAX(3)*UMAX(3))
      TANLO(8)=CUTDAT(3)+TCONT(1)*CUTDAT(4)
      IF(DABS(TANLO(8))-Z1EM5)43,46,46
C  IF GREATER THAN ZERO, PT. CIRCLE FOLLOWED BY CORNER CIRCLE OR JUST
C  CORNER CIRCLE. OTHERWISE PT. CIRCLE (MAYBE), LOWER LINE SEGMENT, PT.
C  CIRCLE, AND THEN CORNER CIRCLE
   43 IF(Z1EM5-DABS(TANLO(3))) 44,44,54
   44 IF(TANLO(3))45,45,50
   45 GO TO 39
   46 IF(TANLO(8))51,47,47
C  IF GREATER THAN ZERO,PT. CIRCLE (MAYBE), LOWER LINE SEGMENT, PT. CIR-
C  CLE, AND THEN CORNER CIRCLE. IF = 0, PT. CIRCLE AND CORNER CIRCLE.
C  ERROR LESS THAN ZERO
   51 IF(CORRAD(4)*CORRAD(4)-TANLO(1))52,53,50
   52 GO TO 39
C  IF GREATER THAN ZERO, CORNER CIRCLE TANGENT TO LOWER LINE SEGMENT
   47 IF(Z1EM5-DABS(TANLO(3))) 48,48,55
   48 IF(TANLO(3))49,49,50
   49 GO TO 39
C  LOWER LINE SEGMENT, PT. CIRCLE, AND CORNER CIRCLE PARAMETER CALC.
   50 TCONT(3)=DSQRT(TANLO(3))/UMAX(3)
      TANHI(3)=(Z1-TCONT(1)*TCONT(3))/(TCONT(1)+TCONT(3))
      TLHITE(3)=SINL(2)*UMAX(2)
      RI(3)=COSL(2)*UMAX(2)
      TANLO(3)=TANHI(1)
      TANLO(4)=TANHI(3)
      GO TO 56
   62 IF(Z1EM5-DABS(UMAX(4)-CORRAD(4))) 63,63,64
   63 NUMERR=22215
      GO TO 1000
C  IF GREATER THAN ZERO, CORNER CIRCLE MEETS UPPER PT. CIRCLE AT UNAC-
C  CEPTABLE ANGLE. IF = 0 WE MUST CHANGE PARAMETERS FOR UPPER PT. CIRCLE
   64 IF(CUTDAT(7)-CUTDAT(4))78,66,63
   78 CALL AERR(-22216,'CUTTER  ')
      TANLO(7)=(CUTDAT(4)-CUTDAT(7))/(RI(6)+SINL(6)-CUTDAT(3))
   79 TCONT(6)=Z0
   80 TANHI(4)=Z0
      GO TO 85
C  NO UPPER LINE SEGMENT. CHANGE IN PARAMETERS FOR UPPER POINT CIRCLE
C  NECESSARY DUE TO NATURE OF CORNER CIRCLE
   66 CALL AERR(-22216,'CUTTER  ')
      TANLO(7)=Z0
      GO TO 79
C  IF GREATER THAN ZERO,CORNER CIRCLE AND THEN UPPER PT. CIRCLE. OTHER-
C  WISE CORNER CIRCLE, PT. CIRCLE, UPPER LINE, AND THEN UPPER PT. CIRCLE
   69 IF(Z1EM5-DABS(TCONT(7))) 70,70,79
   70 IF(TCONT(7))71,71,83
   71 GO TO 41
   74 TANHI(4)=TANLO(7)
      GO TO 84
   77 IF(Z1EM5-DABS(CORRAD(4)-UMAX(4))) 81,81,78
   81 IF(CORRAD(4)-UMAX(4))82,82,83
   82 GO TO 41
C  FURTHER CALCULATIONS FOR TLLDAT BLOCK PARAMETERS
   83 TCONT(5)=DSQRT(TCONT(7))/UMAX(5)
      TANHI(4)=(TCONT(5)+TANLO(7))/(Z1-TCONT(5)*TANLO(7))
      TANLO(5)=TANHI(4)
      TANHI(5)=TANLO(7)
   84 RI(5)=RI(7)-COSL(6)*UMAX(6)
      TLHITE(5)=CUTDAT(7)-SINL(6)*UMAX(6)
      TLHITE(6)=TLHITE(5)
      RI(6)=RI(5)
   85 TLHITE(4)=CUTDAT(4)
      RI(4)=CUTDAT(3)
   86 TCONT(4)=Z1
   87 TANLO(1)=Z1E38
      TLINC(2)=Z1
      TLINC(6)=Z1
      TLHITE(7)=CUTDAT(7)
  200 IBEGIN=1
C  WE NOW SEARCH EACH OF THE 7 POSSIBLE SEGMENTS TO DETERMINE FIRST ONE
   91 IF(TCONT(IBEGIN))90,88,90
   90 TCONT(IBEGIN-1)=-Z1
      TCONT(8)=-Z1
      TCONT(7)=Z1
      TANHI(7)=-Z1E38
      TANHI(8)=-Z1E38
      TANLO(8)=Z1E38
      TLINC(8)=Z0
      CORRAD(8)=Z0
      ICTDEF=0
      IAERR=0
      CALL TLCONV
      GO TO 9999
   88 IBEGIN=IBEGIN+1
      IF(7-IBEGIN)89,91,91
   89 NUMERR=22217
      GO TO 1000
   92 IF(CUTDAT(7))4,93,10
   93 IPT1=0
      TANLO(7)=Z1E38
      IBEGIN=7
      GO TO 90
C
C        ** CUTTER PARAMETER ERROR-CALL AERR AND DEFINE POINT CUTTER
C
 1000 IAERFG=1
      ICTDEF=0
      CALL AERR(NUMERR,'CUTTER  ')
 9990 DO 1001 JJ=1,7
 1001 PARAM(JJ)=Z0
      NUMBER=K7
      FLG=.FALSE.
      GO TO 105
 9999 CONTINUE
      FLG=.FALSE.
      RETURN
      END
C
C
C
C
      SUBROUTINE CUTTEH
      IMPLICIT DOUBLE PRECISION(A-H),DOUBLE PRECISION(O-Z)
C
C
C
C
      INCLUDE 'TOTAL.INC'
      INCLUDE 'FXCOR.INC'
      INCLUDE 'ZNUMBR.INC'
      INCLUDE 'IFXCOR.INC'
      INCLUDE 'ISHR18.INC'
      INCLUDE 'KNUMBR.INC'
C
C
C
      INTEGER HCUTER(2)
      INTEGER BCDF
C
C
C     25.   COMMON FOR AERR INFORMATION
C
      COMMON /AERCOM / IAERFG
C
      COMMON /HSAVE/ SAVEH(50)
      EQUIVALENCE  (SAVEH( 6),PARAM(1) ),(SAVEH(15),NUMBER    )
C     -----------------------------------------------------------
C
C
C...  DEFINES CUTTER SHAPE AND SETS UP TOOL DATA BLOCKS
      DIMENSION PARAM(9)
      HCUTER(1) = BCDF('CUTT')
      HCUTER(2) = BCDF('ER  ')
C
  105 ICTDEF=K1
C...  ZERO CUTTER PARAMETER STORAGE AREA
      DO 110 J=1,7
  110 CUTDAT(J)=Z0
      CUTDAT(7) = TLHIT
      IF(NUMBER-K7)126,126,125
  125 NUMERR=22201
      GO TO 1000
  126 DO 127 J=1,NUMBER
  127 CUTDAT(J)=PARAM(J)
C  WRITE CUTTER STATEMENT ON EXFILE
      CALL APT299(NUMBER,HCUTER,1,PARAM(1))
      IF(NUMBER.LE.1) GO TO 129
      KK=1
      DO 128 I=2,NUMBER,2
      IF(I.EQ.NUMBER) KK=0
  128 CALL APT299(1,PARAM(I),KK,PARAM(I+1))
C
C  PLACE ZEROES IN TLLDAT BLOCK
C
  129 DO 1 I=1,8
      TLHITE(I)=Z0
      SINL(I)=Z0
      COSL(I)=Z0
      UMAX(I)=Z0
      RI(I)=Z0
      CORRAD(I)=Z0
      TCONT(I)=Z0
      TLINC(I)=Z0
    1 CONTINUE
C  MAKE SURE TOOL DIAMETER NOT LESS THAN ZERO
      IF(CUTDAT(1))2,92,3
    2 NUMERR=22202
      GO TO 1000
C  EXAMINE TOOL HEIGHT. IF LESS THAN ZERO ERROR. SET TO 5 IF = ZERO.
C  OKAY OTHERWISE
    3 IF(CUTDAT(7))4,5,6
    4 NUMERR=22203
      GO TO 1000
    5 CONTINUE
C  SUM OF ANGLES A AND B MUST BE LESS THAN 90 DEGREES
    6 IF(Z90-CUTDAT(5)-CUTDAT( 6))7,7,8
    7 NUMERR=22204
      GO TO 1000
    8 RI(6)=Z5EM1*CUTDAT(1)
      CUTDAT(1)=RI(6)
C  ERROR IF ANGLE A NEGATIVE
      IF(CUTDAT(5))9,10,11
    9 NUMERR=22205
      GO TO 1000
   10 COSL(2)=Z1
      TANHI(1)=Z1E38
      GO TO 12
C  COMPUTE PARAMETERS FOR CERTAIN TOOL SEGMENTS FOR A GREATER THAN ZERO
   11 TLHITE(8)=DEGRAD*CUTDAT(5)
      SINL(2)=DSIN(TLHITE(8))
      COSL(2)=DCOS(TLHITE(8))
      TCONT(1)=SINL(2)/COSL(2)
      TLHITE(6)=TCONT(1)*RI(6)
      TANHI(1)=Z1/TCONT(1)
C  MAKE SURE HEIGHT OF BOTTOM LINE SEGMENT DOES NOT EXCEED TOOL HEIGHT
   12 IF(Z1EM5-DABS(CUTDAT(7)-TLHITE(6))) 13,13,15
   13 IF(CUTDAT(7)-TLHITE(6))14,14,16
   14 NUMERR=22206
      GO TO 1000
   15 TLHITE(6)=CUTDAT(7)
C  ERROR IF ANGLE B NEGATIVE
   16 IPT1=K1
      IF(CUTDAT(6))17,18,19
C                    BELL SHAPED CUTTER
   17 CALL AERR (-22207,'CUTTEH  ')
      GO TO 19
   18 SINL(6)=Z1
      GO TO 20
C  COMPUTE PARAMETERS FOR CERTAIN TOOL SEGMENTS FOR B GREATER THAN ZERO
   19 TANHI(8)=DEGRAD*CUTDAT(6)
      SINL(6)=DCOS(TANHI(8))
      COSL(6)=DSIN(TANHI(8))
      TANLO(7)=COSL(6)/SINL(6)
C  FURTHER CALCULATIONS
   20 UMAX(2)=RI(6)/COSL(2)
      UMAX(6)=(CUTDAT(7)-TLHITE(6))/SINL(6)
      RI(7)=RI(6)+COSL(6)*UMAX(6)
      TCONT(2)=Z1
      TCONT(6)=Z1
C  EXAMINE TOOL RADIUS. IF GREATER THAN ZERO, CORNER CIRCLE WILL BE PART
C  OF TOOL CONFIGURATION. IF = ZERO, TOOL WILL CONSIST ONLY OF LINE AND
C  POINT CIRCLE SEGMENTS. ERROR IF NEGATIVE.
      IF(CUTDAT(2))21,22,25
   21 NUMERR=22208
      GO TO 1000
C  COMPARE LENGTH OF UPPER LINE SEGMENT TO ZERO. SET VALUES IN TLLDAT
C  BLOCK ACCORDINGLY
   22 IF(UMAX(6))23,23,24
   23 TANLO(7)=TANHI(1)
      TCONT(6)=Z0
      GO TO 87
   24 TLHITE(4)=TLHITE(6)
      RI(4)=RI(6)
      TANHI(4)=TANLO(7)
      TANLO(4)=TANHI(1)
      GO TO 86
C  COMPUTE CENTER OF CORNER CIRCLE
   27 CUTDAT(3)=RI(6)-CORRAD(4)
      CUTDAT(4)=CORRAD(4)
      GO TO 26
C  STORE RADIUS OF CORNER CIRCLE AND COMPUTE DISTANCE FROM CENTER OF
C  CIRCLE TO BOTTOM LINE (UMAX(3))
   25 CORRAD(4)=CUTDAT(2)
   26 UMAX(3)=CUTDAT(4)*COSL(2)-CUTDAT(3)*SINL(2)
      TANLO(1)=CUTDAT(3)*CUTDAT(3)+CUTDAT(4)*CUTDAT(4)
C  IF = 0, CENTER OF CORNER CIRCLE HAS TO BE CALCULATED
      IF(TANLO(1)+CUTDAT(5)+CUTDAT(6)*CUTDAT(6))28,27,28
C  DISTANCE FROM CENTER OF CIRCLE TO INTERSECTION OF LINE SEGMENTS
   28 UMAX(1)=DSQRT((CUTDAT(3)-RI(6))*(CUTDAT(3)-RI(6))
     1        +(CUTDAT(4)-TLHITE(6))*(CUTDAT(4)-TLHITE(6)))
      UMAX(7)=TANLO(7)*(CUTDAT(7)-TLHITE(6))
C  DISTANCE FROM CENTER OF CIRCLE TO UPPER END OF UPPER LINE SEGMENT
      UMAX(4)=DSQRT((CUTDAT(4)-CUTDAT(7))*(CUTDAT(4)-CUTDAT(7))
     1        +(CUTDAT(3)-RI(7))*(CUTDAT(3)-RI(7)))
C  IF THE Y COORD. (F) OF THE CENTER OF THE CORNER CIRCLE IS LESS THAN
C  THE Y COORD. OF THE INTERSECTION OF THE LINES, THEN ERROR
      IF(CUTDAT(4)+Z1EM5-TLHITE(6))29,29,30
   29 NUMERR=22209
      GO TO 1000
C  IF THE RADIUS IS BOTH LARGER THAN THE DISTANCE TO THE INTERSECTION
C  OF THE LINES AND DIFFERENT THAN THE DISTANCE TO THE ORIGIN OF THE
C  BOTTOM LINE SEGMENT, WE HAVE AN INVALID TOOL CONFIGURATION
   33 IF(Z1EM5-DABS(TANLO(1)-CORRAD(4)*CORRAD(4))) 34,34,35
   34 NUMERR=22210
      GO TO 1000
C  IF E GREATER THAN ZERO, WE HAVE AN INVALID TOOL CONFIGURATION
   35 IF(CUTDAT(3))53,37,34
   53 CALL AERR(-22211,'CUTTEH  ')
      TANHI(1)=CUTDAT(4)/CUTDAT(3)
      TCONT(1)=CUTDAT(3)/CUTDAT(4)
C  NO LOWER LINE SEGMENT
   54 TCONT(2)=Z0
C  FURTHER TLLDAT VARIABLES
   55 TANLO(4)=TANHI(1)
   56 UMAX(5)=(RI(6)-CUTDAT(3))*SINL(6)+COSL(6)*(CUTDAT(4)-TLHITE(6))
C  IF = 0, THERE IS NO UPPER LINE SEGMENT AND IN THIS CASE TOOL NO GOOD
      IF(UMAX(6))67,57,67
C  IF GREATER THAN ZERO, RADIUS AND DISTANCE FROM CENTER OF CORNER
C  CIRCLE TO INTERSECTION OF LINES EQUAL.
   67 IF(CORRAD(4)-UMAX(1))68,68,62
   68 TCONT(7)=CORRAD(4)*CORRAD(4)-UMAX(5)*UMAX(5)
C  LENGTH OF UPPER LINE SEGMENT
      UMAX(6)=UMAX(6)+DSQRT(DABS(TCONT(7)))
     1       -DSQRT(UMAX(1)*UMAX(1)-UMAX(5)*UMAX(5))
      UMAX(8)=CUTDAT(4)-CUTDAT(7)-TANLO(7)*(UMAX(7)+RI(6)-CUTDAT(3))
      IF(Z1EM5-DABS(UMAX(8))) 72,72,69
   72 IF(UMAX(8))73,73,77
C  IF GREATER THAN ZERO, UPPER LINE SEGMENT WITH CORNER CIRCLE TANGENT.
C  OTHERWISE CORNER CIRCLE, PT. CIRCLE, UPPER LINE, AND THEN PT. CIRCLE
   73 IF(Z1EM5-DABS(TCONT(7))) 75,75,74
   75 IF(TCONT(7))76,76,83
   76 GO TO 41
   57 NUMERR=22212
      GO TO 1000
C  WE MUST CHANGE PARAMETERS FOR BOTTOM POINT CIRCLE DUE TO NATURE OF
C  CORNER CIRCLE
   37 CALL AERR(-22211,'CUTTEH  ')
      TCONT(1)=Z0
      TANHI(1)=Z1E38
      GO TO 54
C  IF GREATER THAN OR EQUAL TO ZERO, CORNER CIRCLE IS A POINT CIRCLE
   30 IF(Z1EM5-DABS(CORRAD(4)-UMAX(1))) 32,31,31
   31 CORRAD(4) = 0.
      TANLO(1) = 0.
      UMAX(1) = 0.
      UMAX(3) = 0.
      UMAX(4) = 0.
      UMAX(7) = 0.
      CUTDAT(2) = 0.
      CUTDAT(3) = 0.
      CUTDAT(4) = 0.
      GO TO 22
   32 IF (CORRAD(4)-UMAX(1)) 38,38,33
   38 IF(RI(6)+TCONT(1)*(TLHITE(6)-CUTDAT(4))-
     1CUTDAT(3)+Z1EM5)39,39,40
C  CORNER CIRCLE INTERSECTS LOWER LINE SEGMENT AT AN UNACCEPTABLE ANGLE
   39 NUMERR=22213
      GO TO 1000
   40 IF(CUTDAT(4)+Z1EM5-TLHITE(6)-TANLO(7)*(RI(6)-
     1CUTDAT(3)))41,41,42
C  CORNER CIRCLE INTERSECTS UPPER LINE SEGMENT AT AN UNACCEPTABLE ANGLE
   41 NUMERR=22214
      GO TO 1000
   42 TANLO(3)=CORRAD(4)*CORRAD(4)-UMAX(3)*UMAX(3)
      IF(TANLO(3).LT.Z0)GO TO 39
C  LENGTH OF LOWER LINE SEGMENT
      UMAX(2)=UMAX(2)+DSQRT(TANLO(3))
     1       -DSQRT(UMAX(1)*UMAX(1)-UMAX(3)*UMAX(3))
      TANLO(8)=CUTDAT(3)+TCONT(1)*CUTDAT(4)
      IF(DABS(TANLO(8))-Z1EM5)43,46,46
C  IF GREATER THAN ZERO, PT. CIRCLE FOLLOWED BY CORNER CIRCLE OR JUST
C  CORNER CIRCLE. OTHERWISE PT. CIRCLE (MAYBE), LOWER LINE SEGMENT, PT.
C  CIRCLE, AND THEN CORNER CIRCLE
   43 IF(Z1EM5-DABS(TANLO(3))) 44,44,54
   44 IF(TANLO(3))45,45,50
   45 GO TO 39
   46 IF(TANLO(8))51,47,47
C  IF GREATER THAN ZERO,PT. CIRCLE (MAYBE), LOWER LINE SEGMENT, PT. CIR-
C  CLE, AND THEN CORNER CIRCLE. IF = 0, PT. CIRCLE AND CORNER CIRCLE.
C  ERROR LESS THAN ZERO
   51 IF(CORRAD(4)*CORRAD(4)-TANLO(1))52,53,50
   52 GO TO 39
C  IF GREATER THAN ZERO, CORNER CIRCLE TANGENT TO LOWER LINE SEGMENT
   47 IF(Z1EM5-DABS(TANLO(3))) 48,48,55
   48 IF(TANLO(3))49,49,50
   49 GO TO 39
C  LOWER LINE SEGMENT, PT. CIRCLE, AND CORNER CIRCLE PARAMETER CALC.
   50 TCONT(3)=DSQRT(TANLO(3))/UMAX(3)
      TANHI(3)=(Z1-TCONT(1)*TCONT(3))/(TCONT(1)+TCONT(3))
      TLHITE(3)=SINL(2)*UMAX(2)
      RI(3)=COSL(2)*UMAX(2)
      TANLO(3)=TANHI(1)
      TANLO(4)=TANHI(3)
      GO TO 56
   62 IF(Z1EM5-DABS(UMAX(4)-CORRAD(4))) 63,63,64
   63 NUMERR=22215
      GO TO 1000
C  IF GREATER THAN ZERO, CORNER CIRCLE MEETS UPPER PT. CIRCLE AT UNAC-
C  CEPTABLE ANGLE. IF = 0 WE MUST CHANGE PARAMETERS FOR UPPER PT. CIRCLE
   64 IF(CUTDAT(7)-CUTDAT(4))78,66,63
   78 CALL AERR(-22216,'CUTTEH  ')
      TANLO(7)=(CUTDAT(4)-CUTDAT(7))/(RI(6)+SINL(6)-CUTDAT(3))
   79 TCONT(6)=Z0
   80 TANHI(4)=Z0
      GO TO 85
C  NO UPPER LINE SEGMENT. CHANGE IN PARAMETERS FOR UPPER POINT CIRCLE
C  NECESSARY DUE TO NATURE OF CORNER CIRCLE
   66 CALL AERR(-22216,'CUTTEH  ')
      TANLO(7)=Z0
      GO TO 79
C  IF GREATER THAN ZERO,CORNER CIRCLE AND THEN UPPER PT. CIRCLE. OTHER-
C  WISE CORNER CIRCLE, PT. CIRCLE, UPPER LINE, AND THEN UPPER PT. CIRCLE
   69 IF(Z1EM5-DABS(TCONT(7))) 70,70,79
   70 IF(TCONT(7))71,71,83
   71 GO TO 41
   74 TANHI(4)=TANLO(7)
      GO TO 84
   77 IF(Z1EM5-DABS(CORRAD(4)-UMAX(4))) 81,81,78
   81 IF(CORRAD(4)-UMAX(4))82,82,83
   82 GO TO 41
C  FURTHER CALCULATIONS FOR TLLDAT BLOCK PARAMETERS
   83 TCONT(5)=DSQRT(TCONT(7))/UMAX(5)
      TANHI(4)=(TCONT(5)+TANLO(7))/(Z1-TCONT(5)*TANLO(7))
      TANLO(5)=TANHI(4)
      TANHI(5)=TANLO(7)
   84 RI(5)=RI(7)-COSL(6)*UMAX(6)
      TLHITE(5)=CUTDAT(7)-SINL(6)*UMAX(6)
      TLHITE(6)=TLHITE(5)
      RI(6)=RI(5)
   85 TLHITE(4)=CUTDAT(4)
      RI(4)=CUTDAT(3)
   86 TCONT(4)=Z1
   87 TANLO(1)=Z1E38
      TLINC(2)=Z1
      TLINC(6)=Z1
      TLHITE(7)=CUTDAT(7)
  200 IBEGIN=1
C  WE NOW SEARCH EACH OF THE 7 POSSIBLE SEGMENTS TO DETERMINE FIRST ONE
   91 IF(TCONT(IBEGIN))90,88,90
   90 TCONT(IBEGIN-1)=-Z1
      TCONT(8)=-Z1
      TCONT(7)=Z1
      TANHI(7)=-Z1E38
      TANHI(8)=-Z1E38
      TANLO(8)=Z1E38
      TLINC(8)=Z0
      CORRAD(8)=Z0
      ICTDEF=0
      IAERR=0
      CALL TLCONV
      GO TO 9999
   88 IBEGIN=IBEGIN+1
      IF(7-IBEGIN)89,91,91
   89 NUMERR=22217
      GO TO 1000
   92 IF(CUTDAT(7))4,93,10
   93 IPT1=0
      TANLO(7)=Z1E38
      IBEGIN=7
      GO TO 90
C
C        ** CUTTER PARAMETER ERROR-CALL AERR AND DEFINE POINT CUTTER
C
 1000 IAERFG=1
      ICTDEF=0
      CALL AERR(NUMERR,'CUTTEH  ')
 9990 DO 1001 JJ=1,7
 1001 PARAM(JJ)=Z0
      NUMBER=K7
      GO TO 105
 9999 CONTINUE
      RETURN
       END
C
C
C
C
      SUBROUTINE CUTRED
      IMPLICIT DOUBLE PRECISION(A-H),DOUBLE PRECISION(O-Z)
C
C
C
C
      INCLUDE 'TOTAL.INC'
      INCLUDE 'FXCOR.INC'
      INCLUDE 'ZNUMBR.INC'
      INCLUDE 'IFXCOR.INC'
      INCLUDE 'ISHR18.INC'
      INCLUDE 'KNUMBR.INC'
C
C
C
      INTEGER HCUTER(2)
      INTEGER BCDF
C
C
C     25.   COMMON FOR AERR INFORMATION
C
      COMMON /AERCOM / IAERFG
C
      COMMON /HSAVE/ SAVEH(50)
      EQUIVALENCE  (SAVEH( 6),PARAM(1) ),(SAVEH(15),NUMBER    )
C     -----------------------------------------------------------
C
C
C...  DEFINES CUTTER SHAPE AND SETS UP TOOL DATA BLOCKS
      DIMENSION PARAM(9)
C
      HCUTER(1) = BCDF('CUTT')
      HCUTER(2) = BCDF('ER  ')
C
C  PLACE ZEROES IN TLLDAT BLOCK
C        CUTRED ROUTINE TO REDEFINE EXISTING CUTTER FOR NEW UNITS/
  129 DO 1 I=1,8
      TLHITE(I)=Z0
      SINL(I)=Z0
      COSL(I)=Z0
      UMAX(I)=Z0
      RI(I)=Z0
      CORRAD(I)=Z0
      TCONT(I)=Z0
      TLINC(I)=Z0
    1 CONTINUE
C  MAKE SURE TOOL DIAMETER NOT LESS THAN ZERO
      IF(CUTDAT(1))2,92,3
    2 NUMERR=22202
      GO TO 1000
C  EXAMINE TOOL HEIGHT. IF LESS THAN ZERO ERROR. SET TO 5 IF = ZERO.
C  OKAY OTHERWISE
    3 IF(CUTDAT(7))4,5,6
    4 NUMERR=22203
      GO TO 1000
    5 CONTINUE
C  SUM OF ANGLES A AND B MUST BE LESS THAN 90 DEGREES
    6 IF(Z90-CUTDAT(5)-CUTDAT( 6))7,7,8
    7 NUMERR=22204
      GO TO 1000
    8 RI(6)=Z5EM1*CUTDAT(1)
      CUTDAT(1)=RI(6)
C  ERROR IF ANGLE A NEGATIVE
      IF(CUTDAT(5))9,10,11
    9 NUMERR=22205
      GO TO 1000
   10 COSL(2)=Z1
      TANHI(1)=Z1E38
      GO TO 12
C  COMPUTE PARAMETERS FOR CERTAIN TOOL SEGMENTS FOR A GREATER THAN ZERO
   11 TLHITE(8)=DEGRAD*CUTDAT(5)
      SINL(2)=DSIN(TLHITE(8))
      COSL(2)=DCOS(TLHITE(8))
      TCONT(1)=SINL(2)/COSL(2)
      TLHITE(6)=TCONT(1)*RI(6)
      TANHI(1)=Z1/TCONT(1)
C  MAKE SURE HEIGHT OF BOTTOM LINE SEGMENT DOES NOT EXCEED TOOL HEIGHT
   12 IF(Z1EM5-DABS(CUTDAT(7)-TLHITE(6))) 13,13,15
   13 IF(CUTDAT(7)-TLHITE(6))14,14,16
   14 NUMERR=22206
      GO TO 1000
   15 TLHITE(6)=CUTDAT(7)
C  ERROR IF ANGLE B NEGATIVE
   16 IPT1=K1
      IF(CUTDAT(6))17,18,19
C                    BELL SHAPED CUTTER
   17 CALL AERR (-22207,'CUTRED  ')
      GO TO 19
   18 SINL(6)=Z1
      GO TO 20
C  COMPUTE PARAMETERS FOR CERTAIN TOOL SEGMENTS FOR B GREATER THAN ZERO
   19 TANHI(8)=DEGRAD*CUTDAT(6)
      SINL(6)=DCOS(TANHI(8))
      COSL(6)=DSIN(TANHI(8))
      TANLO(7)=COSL(6)/SINL(6)
C  FURTHER CALCULATIONS
   20 UMAX(2)=RI(6)/COSL(2)
      UMAX(6)=(CUTDAT(7)-TLHITE(6))/SINL(6)
      RI(7)=RI(6)+COSL(6)*UMAX(6)
      TCONT(2)=Z1
      TCONT(6)=Z1
C  EXAMINE TOOL RADIUS. IF GREATER THAN ZERO, CORNER CIRCLE WILL BE PART
C  OF TOOL CONFIGURATION. IF = ZERO, TOOL WILL CONSIST ONLY OF LINE AND
C  POINT CIRCLE SEGMENTS. ERROR IF NEGATIVE.
      IF(CUTDAT(2))21,22,25
   21 NUMERR=22208
      GO TO 1000
C  COMPARE LENGTH OF UPPER LINE SEGMENT TO ZERO. SET VALUES IN TLLDAT
C  BLOCK ACCORDINGLY
   22 IF(UMAX(6))23,23,24
   23 TANLO(7)=TANHI(1)
      TCONT(6)=Z0
      GO TO 87
   24 TLHITE(4)=TLHITE(6)
      RI(4)=RI(6)
      TANHI(4)=TANLO(7)
      TANLO(4)=TANHI(1)
      GO TO 86
C  COMPUTE CENTER OF CORNER CIRCLE
   27 CUTDAT(3)=RI(6)-CORRAD(4)
      CUTDAT(4)=CORRAD(4)
      GO TO 26
C  STORE RADIUS OF CORNER CIRCLE AND COMPUTE DISTANCE FROM CENTER OF
C  CIRCLE TO BOTTOM LINE (UMAX(3))
   25 CORRAD(4)=CUTDAT(2)
   26 UMAX(3)=CUTDAT(4)*COSL(2)-CUTDAT(3)*SINL(2)
      TANLO(1)=CUTDAT(3)*CUTDAT(3)+CUTDAT(4)*CUTDAT(4)
C  IF = 0, CENTER OF CORNER CIRCLE HAS TO BE CALCULATED
      IF(TANLO(1)+CUTDAT(5)+CUTDAT(6)*CUTDAT(6))28,27,28
C  DISTANCE FROM CENTER OF CIRCLE TO INTERSECTION OF LINE SEGMENTS
   28 UMAX(1)=DSQRT((CUTDAT(3)-RI(6))*(CUTDAT(3)-RI(6))
     1        +(CUTDAT(4)-TLHITE(6))*(CUTDAT(4)-TLHITE(6)))
      UMAX(7)=TANLO(7)*(CUTDAT(7)-TLHITE(6))
C  DISTANCE FROM CENTER OF CIRCLE TO UPPER END OF UPPER LINE SEGMENT
      UMAX(4)=DSQRT((CUTDAT(4)-CUTDAT(7))*(CUTDAT(4)-CUTDAT(7))
     1        +(CUTDAT(3)-RI(7))*(CUTDAT(3)-RI(7)))
C  IF THE Y COORD. (F) OF THE CENTER OF THE CORNER CIRCLE IS LESS THAN
C  THE Y COORD. OF THE INTERSECTION OF THE LINES, THEN ERROR
      IF(CUTDAT(4)+Z1EM5-TLHITE(6))29,29,30
   29 NUMERR=22209
      GO TO 1000
C  IF THE RADIUS IS BOTH LARGER THAN THE DISTANCE TO THE INTERSECTION
C  OF THE LINES AND DIFFERENT THAN THE DISTANCE TO THE ORIGIN OF THE
C  BOTTOM LINE SEGMENT, WE HAVE AN INVALID TOOL CONFIGURATION
   33 IF(Z1EM5-DABS(TANLO(1)-CORRAD(4)*CORRAD(4))) 34,34,35
   34 NUMERR=22210
      GO TO 1000
C  IF E GREATER THAN ZERO, WE HAVE AN INVALID TOOL CONFIGURATION
   35 IF(CUTDAT(3))53,37,34
   53 CALL AERR(-22211,'CUTRED  ')
      TANHI(1)=CUTDAT(4)/CUTDAT(3)
      TCONT(1)=CUTDAT(3)/CUTDAT(4)
C  NO LOWER LINE SEGMENT
   54 TCONT(2)=Z0
C  FURTHER TLLDAT VARIABLES
   55 TANLO(4)=TANHI(1)
   56 UMAX(5)=(RI(6)-CUTDAT(3))*SINL(6)+COSL(6)*(CUTDAT(4)-TLHITE(6))
C  IF = 0, THERE IS NO UPPER LINE SEGMENT AND IN THIS CASE TOOL NO GOOD
      IF(UMAX(6))67,57,67
C  IF GREATER THAN ZERO, RADIUS AND DISTANCE FROM CENTER OF CORNER
C  CIRCLE TO INTERSECTION OF LINES EQUAL.
   67 IF(CORRAD(4)-UMAX(1))68,68,62
   68 TCONT(7)=CORRAD(4)*CORRAD(4)-UMAX(5)*UMAX(5)
C  LENGTH OF UPPER LINE SEGMENT
      UMAX(6)=UMAX(6)+DSQRT(DABS(TCONT(7)))
     1       -DSQRT(UMAX(1)*UMAX(1)-UMAX(5)*UMAX(5))
      UMAX(8)=CUTDAT(4)-CUTDAT(7)-TANLO(7)*(UMAX(7)+RI(6)-CUTDAT(3))
      IF(Z1EM5-DABS(UMAX(8))) 72,72,69
   72 IF(UMAX(8))73,73,77
C  IF GREATER THAN ZERO, UPPER LINE SEGMENT WITH CORNER CIRCLE TANGENT.
C  OTHERWISE CORNER CIRCLE, PT. CIRCLE, UPPER LINE, AND THEN PT. CIRCLE
   73 IF(Z1EM5-DABS(TCONT(7))) 75,75,74
   75 IF(TCONT(7))76,76,83
   76 GO TO 41
   57 NUMERR=22212
      GO TO 1000
C  WE MUST CHANGE PARAMETERS FOR BOTTOM POINT CIRCLE DUE TO NATURE OF
C  CORNER CIRCLE
   37 CALL AERR(-22211,'CUTRED  ')
      TCONT(1)=Z0
      TANHI(1)=Z1E38
      GO TO 54
C  IF GREATER THAN OR EQUAL TO ZERO, CORNER CIRCLE IS A POINT CIRCLE
   30 IF(Z1EM5-DABS(CORRAD(4)-UMAX(1))) 32,31,31
   31 CORRAD(4) = 0.
      TANLO(1) = 0.
      UMAX(1) = 0.
      UMAX(3) = 0.
      UMAX(4) = 0.
      UMAX(7) = 0.
      CUTDAT(2) = 0.
      CUTDAT(3) = 0.
      CUTDAT(4) = 0.
      GO TO 22
   32 IF (CORRAD(4)-UMAX(1)) 38,38,33
   38 IF(RI(6)+TCONT(1)*(TLHITE(6)-CUTDAT(4))-
     1CUTDAT(3)+Z1EM5)39,39,40
C  CORNER CIRCLE INTERSECTS LOWER LINE SEGMENT AT AN UNACCEPTABLE ANGLE
   39 NUMERR=22213
      GO TO 1000
   40 IF(CUTDAT(4)+Z1EM5-TLHITE(6)-TANLO(7)*(RI(6)-
     1CUTDAT(3)))41,41,42
C  CORNER CIRCLE INTERSECTS UPPER LINE SEGMENT AT AN UNACCEPTABLE ANGLE
   41 NUMERR=22214
      GO TO 1000
   42 TANLO(3)=CORRAD(4)*CORRAD(4)-UMAX(3)*UMAX(3)
      IF(TANLO(3).LT.Z0)GO TO 39
C  LENGTH OF LOWER LINE SEGMENT
      UMAX(2)=UMAX(2)+DSQRT(TANLO(3))
     1       -DSQRT(UMAX(1)*UMAX(1)-UMAX(3)*UMAX(3))
      TANLO(8)=CUTDAT(3)+TCONT(1)*CUTDAT(4)
      IF(DABS(TANLO(8))-Z1EM5)43,46,46
C  IF GREATER THAN ZERO, PT. CIRCLE FOLLOWED BY CORNER CIRCLE OR JUST
C  CORNER CIRCLE. OTHERWISE PT. CIRCLE (MAYBE), LOWER LINE SEGMENT, PT.
C  CIRCLE, AND THEN CORNER CIRCLE
   43 IF(Z1EM5-DABS(TANLO(3))) 44,44,54
   44 IF(TANLO(3))45,45,50
   45 GO TO 39
   46 IF(TANLO(8))51,47,47
C  IF GREATER THAN ZERO,PT. CIRCLE (MAYBE), LOWER LINE SEGMENT, PT. CIR-
C  CLE, AND THEN CORNER CIRCLE. IF = 0, PT. CIRCLE AND CORNER CIRCLE.
C  ERROR LESS THAN ZERO
   51 IF(CORRAD(4)*CORRAD(4)-TANLO(1))52,53,50
   52 GO TO 39
C  IF GREATER THAN ZERO, CORNER CIRCLE TANGENT TO LOWER LINE SEGMENT
   47 IF(Z1EM5-DABS(TANLO(3))) 48,48,55
   48 IF(TANLO(3))49,49,50
   49 GO TO 39
C  LOWER LINE SEGMENT, PT. CIRCLE, AND CORNER CIRCLE PARAMETER CALC.
   50 TCONT(3)=DSQRT(TANLO(3))/UMAX(3)
      TANHI(3)=(Z1-TCONT(1)*TCONT(3))/(TCONT(1)+TCONT(3))
      TLHITE(3)=SINL(2)*UMAX(2)
      RI(3)=COSL(2)*UMAX(2)
      TANLO(3)=TANHI(1)
      TANLO(4)=TANHI(3)
      GO TO 56
   62 IF(Z1EM5-DABS(UMAX(4)-CORRAD(4))) 63,63,64
   63 NUMERR=22215
      GO TO 1000
C  IF GREATER THAN ZERO, CORNER CIRCLE MEETS UPPER PT. CIRCLE AT UNAC-
C  CEPTABLE ANGLE. IF = 0 WE MUST CHANGE PARAMETERS FOR UPPER PT. CIRCLE
   64 IF(CUTDAT(7)-CUTDAT(4))78,66,63
   78 CALL AERR(-22216,'CUTRED  ')
      TANLO(7)=(CUTDAT(4)-CUTDAT(7))/(RI(6)+SINL(6)-CUTDAT(3))
   79 TCONT(6)=Z0
   80 TANHI(4)=Z0
      GO TO 85
C  NO UPPER LINE SEGMENT. CHANGE IN PARAMETERS FOR UPPER POINT CIRCLE
C  NECESSARY DUE TO NATURE OF CORNER CIRCLE
   66 CALL AERR(-22216,'CUTRED  ')
      TANLO(7)=Z0
      GO TO 79
C  IF GREATER THAN ZERO,CORNER CIRCLE AND THEN UPPER PT. CIRCLE. OTHER-
C  WISE CORNER CIRCLE, PT. CIRCLE, UPPER LINE, AND THEN UPPER PT. CIRCLE
   69 IF(Z1EM5-DABS(TCONT(7))) 70,70,79
   70 IF(TCONT(7))71,71,83
   71 GO TO 41
   74 TANHI(4)=TANLO(7)
      GO TO 84
   77 IF(Z1EM5-DABS(CORRAD(4)-UMAX(4))) 81,81,78
   81 IF(CORRAD(4)-UMAX(4))82,82,83
   82 GO TO 41
C  FURTHER CALCULATIONS FOR TLLDAT BLOCK PARAMETERS
   83 TCONT(5)=DSQRT(TCONT(7))/UMAX(5)
      TANHI(4)=(TCONT(5)+TANLO(7))/(Z1-TCONT(5)*TANLO(7))
      TANLO(5)=TANHI(4)
      TANHI(5)=TANLO(7)
   84 RI(5)=RI(7)-COSL(6)*UMAX(6)
      TLHITE(5)=CUTDAT(7)-SINL(6)*UMAX(6)
      TLHITE(6)=TLHITE(5)
      RI(6)=RI(5)
   85 TLHITE(4)=CUTDAT(4)
      RI(4)=CUTDAT(3)
   86 TCONT(4)=Z1
   87 TANLO(1)=Z1E38
      TLINC(2)=Z1
      TLINC(6)=Z1
      TLHITE(7)=CUTDAT(7)
  200 IBEGIN=1
C  WE NOW SEARCH EACH OF THE 7 POSSIBLE SEGMENTS TO DETERMINE FIRST ONE
   91 IF(TCONT(IBEGIN))90,88,90
   90 TCONT(IBEGIN-1)=-Z1
      TCONT(8)=-Z1
      TCONT(7)=Z1
      TANHI(7)=-Z1E38
      TANHI(8)=-Z1E38
      TANLO(8)=Z1E38
      TLINC(8)=Z0
      CORRAD(8)=Z0
      ICTDEF=0
      IAERR=0
      CALL TLCONV
      GO TO 9999
   88 IBEGIN=IBEGIN+1
      IF(7-IBEGIN)89,91,91
   89 NUMERR=22217
      GO TO 1000
   92 IF(CUTDAT(7))4,93,10
   93 IPT1=0
      TANLO(7)=Z1E38
      IBEGIN=7
      GO TO 90
C
C        ** CUTTER PARAMETER ERROR-CALL AERR AND DEFINE POINT CUTTER
C
 1000 IAERFG=1
      ICTDEF=0
      CALL AERR(NUMERR,'CUTRED  ')
 9990 DO 1001 JJ=1,7
 1001 PARAM(JJ)=Z0
      NUMBER=K7
C
      ICTDEF=K1
C...  ZERO CUTTER PARAMETER STORAGE AREA
      DO 110 J=1,7
  110 CUTDAT(J)=Z0
      CUTDAT(7) = TLHIT
      IF(NUMBER-K7)126,126,125
  125 NUMERR=22201
      GO TO 1000
  126 DO 127 J=1,NUMBER
  127 CUTDAT(J)=PARAM(J)
C  WRITE CUTTER STATEMENT ON EXFILE
      CALL APT299(NUMBER,HCUTER,1,PARAM(1))
      IF(NUMBER.LE.1) GO TO 129
      KK=1
      DO 128 I=2,NUMBER,2
      IF(I.EQ.NUMBER) KK=0
  128 CALL APT299(1,PARAM(I),KK,PARAM(I+1))
      GO TO 129
C
 9999 CONTINUE
      RETURN
       END
